<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Team vs Team Overlay</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=IM+Fell+English+SC&display=swap" rel="stylesheet">
<style>
  :root{
    /* Background and theme defaults. Panel push will override team colors. */
    --bg:#141414;
    --a1:#6EA8FF; --a2:#2A3D8F;   /* Team A gradient default */
    --b1:#E38DFF; --b2:#6A2A8F;   /* Team B gradient default */

    /* Gold for VS badge */
    --gold-hi:#F7E6A9;
    --gold-mid:#D4AF37;
    --gold-lo:#8C6A0E;
  }

  html,body{margin:0;height:100%;background:transparent;overflow:hidden}
  /* Lock stage to 1920x1080 for OBS scenes */
  #stage{position:relative;width:1920px;height:1080px;background:var(--bg)}

  /* 3-column layout: left pane, VS column, right pane */
  .grid{
    display:grid;
    grid-template-columns: 1fr 220px 1fr;
    gap:30px;
    height:100%;
    padding:60px; /* outer margin inside frame */
    box-sizing:border-box;
  }

  /* Pane with gradient border using team colors */
  .pane{
    position:relative;
    border-radius:24px;
    padding:18px;
    box-sizing:border-box;

    /* Paint border with gradient without images */
    border:4px solid transparent;
    background:
      linear-gradient(var(--bg), var(--bg)) padding-box,
      var(--pane-grad) border-box;

    box-shadow:
      0 12px 28px rgba(0,0,0,.45),
      inset 0 1px 0 rgba(255,255,255,.05);
    display:flex;
    flex-direction:column;
  }
  .left  { --pane-grad: linear-gradient(180deg, var(--a1), var(--a2)); }
  .right { --pane-grad: linear-gradient(180deg, var(--b1), var(--b2)); }

  /* Top row inside pane: centered name and series on right */
  .pane-top{
    display:grid;
    grid-template-columns: 1fr auto; /* name grows, series hugs right */
    align-items:center;
    min-height:90px;
    margin-bottom:8px;
  }
  .team-name{
    justify-self:center;
    max-width:82%;
    text-align:center;
    font-family:"IM Fell English SC", serif;
    font-weight:400;
    color:#fff;
    text-shadow:0 2px 8px rgba(0,0,0,.6);
    font-size:56px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    transform-origin:center center; /* for scale-down fit */
  }
  .series{
    justify-self:end;
    font-family:"IM Fell English SC", serif;
    color:#fff;
    text-shadow:0 2px 8px rgba(0,0,0,.6);
    font-size:72px;
    line-height:1;
    min-width:70px;
    text-align:right;
  }

  /* Logo area */
  .logo-wrap{
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:18px 24px 28px;
  }
  .logo{
    width:100%;
    height:100%;
    object-fit:contain;
    filter: drop-shadow(0 10px 24px rgba(0,0,0,.55));
  }

  /* Center VS column */
  .vs-col{ display:flex; align-items:center; justify-content:center; }
  .vs-badge{
    position:relative;
    width:180px; height:180px;
    border-radius:50%;

    /* Metallic ring look via layered gradients */
    background:
      radial-gradient(120% 120% at 30% 30%, rgba(255,255,255,.55), rgba(255,255,255,0) 40%) content-box,
      conic-gradient(from 210deg,
        var(--gold-lo), var(--gold-mid), var(--gold-hi), var(--gold-mid),
        var(--gold-lo), var(--gold-mid), var(--gold-hi), var(--gold-mid),
        var(--gold-lo)
      ) padding-box,
      radial-gradient(80% 80% at 50% 50%, #111, #000) border-box;
    border:6px solid transparent;
    box-shadow:
      0 18px 40px rgba(0,0,0,.55),
      inset 0 2px 0 rgba(255,255,255,.35),
      inset 0 -3px 12px rgba(0,0,0,.6);
  }
  .vs-badge::before{
    /* Inner disc */
    content:"";
    position:absolute; inset:18px; border-radius:50%;
    background:
      radial-gradient(100% 100% at 30% 30%, rgba(255,255,255,.18), rgba(255,255,255,0) 55%),
      linear-gradient(180deg, #1a1a1a, #0a0a0a);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.08), inset 0 -2px 10px rgba(0,0,0,.7);
  }
  .vs-badge::after{
    /* Sparkle sweep */
    content:"";
    position:absolute; inset:0; border-radius:50%;
    background: radial-gradient(30% 20% at 25% 25%, rgba(255,255,255,.5), rgba(255,255,255,0) 60%);
    filter: blur(1px); opacity:.35; transform: rotate(0deg);
    animation: sweep 4.2s linear infinite;
    pointer-events:none;
  }
  @keyframes sweep{ 0%{ transform: rotate(0deg) } 100%{ transform: rotate(360deg) } }
  .vs-text{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
    font-family:"IM Fell English SC", serif; font-size:72px; letter-spacing:2px;
    color: transparent;
    background: linear-gradient(180deg, var(--gold-hi), var(--gold-mid) 55%, var(--gold-lo));
    -webkit-background-clip: text; background-clip: text;
    filter: drop-shadow(0 3px 6px rgba(0,0,0,.85));
  }

  /* Subtle update fade for readability on change */
  .fade{ animation: fadein .15s ease-out }
  @keyframes fadein{ from{opacity:.35; transform:translateY(2px)} to{opacity:1; transform:none} }
</style>
</head>
<body>
  <div id="stage" role="img" aria-label="Team vs Team overlay">
    <div class="grid">
      <!-- Left pane -->
      <section class="pane left" aria-label="Team A panel">
        <div class="pane-top">
          <div id="nameA" class="team-name">Team A</div>
          <div id="serA"  class="series" aria-label="Team A series">0</div>
        </div>
        <div class="logo-wrap">
          <img id="logoA" class="logo" src="images/teams/missing_logo.png" alt="Team A logo">
        </div>
      </section>

      <!-- VS badge -->
      <div class="vs-col" aria-hidden="true">
        <div class="vs-badge"><div class="vs-text">VS</div></div>
      </div>

      <!-- Right pane -->
      <section class="pane right" aria-label="Team B panel">
        <div class="pane-top">
          <div id="nameB" class="team-name">Team B</div>
          <div id="serB"  class="series" aria-label="Team B series">0</div>
        </div>
        <div class="logo-wrap">
          <img id="logoB" class="logo" src="images/teams/missing_logo.png" alt="Team B logo">
        </div>
      </section>
    </div>
  </div>

<script type="module">
/* Firebase CDN modules */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";

/* Use the same config as your control panel */
const firebaseConfig = {
  apiKey: "AIzaSyD5mJAchcPP61x--oslD2y-tojorp3ysw8",
  authDomain: "league7overlay.firebaseapp.com",
  projectId: "league7overlay",
  storageBucket: "league7overlay.firebasestorage.app",
  messagingSenderId: "126648845416",
  appId: "1:126648845416:web:06be2078b0c95bbb97a7dd",
  measurementId: "G-QW2NG2BNF9",
  databaseURL: "https://league7overlay-default-rtdb.firebaseio.com"
};

const app  = initializeApp(firebaseConfig);
const db   = getFirestore(app);
const auth = getAuth(app);
/* Anonymous auth covers non-public Firestore rules */
await signInAnonymously(auth).catch(err => console.error('Anon auth failed', err));

const OVERLAY_ID = new URLSearchParams(location.search).get('overlay') || 'main';

/* Elements */
const el = {
  nameA: document.getElementById('nameA'),
  nameB: document.getElementById('nameB'),
  serA:  document.getElementById('serA'),
  serB:  document.getElementById('serB'),
  logoA: document.getElementById('logoA'),
  logoB: document.getElementById('logoB'),
};

/* Fit name into its box by scaling down; ellipsis is already set in CSS */
function fitText(node, minScale=.6){
  const parent = node.parentElement; // the grid cell
  node.style.transform = 'scale(1)';
  let s = 1, guard = 0;
  // allow name to use about 82% of the row width so series space is safe
  while (node.scrollWidth > parent.clientWidth * 0.82 && s > minScale && guard < 60){
    s -= 0.02;
    node.style.transform = `scale(${s})`;
    guard++;
  }
}

/* Logo with safe fallback */
function setLogo(imgEl, filename){
  const base = 'images/teams/';
  const file = filename && filename.trim() ? filename : 'missing_logo.png';
  imgEl.onerror = () => { imgEl.onerror = null; imgEl.src = base + 'missing_logo.png'; };
  imgEl.src = base + file;
}

/* Live color theming for borders */
function setThemeColors(d){
  const a1 = d?.teamAColors?.primary   || getComputedStyle(document.documentElement).getPropertyValue('--a1') || '#6EA8FF';
  const a2 = d?.teamAColors?.secondary || getComputedStyle(document.documentElement).getPropertyValue('--a2') || '#2A3D8F';
  const b1 = d?.teamBColors?.primary   || getComputedStyle(document.documentElement).getPropertyValue('--b1') || '#E38DFF';
  const b2 = d?.teamBColors?.secondary || getComputedStyle(document.documentElement).getPropertyValue('--b2') || '#6A2A8F';
  document.documentElement.style.setProperty('--a1', a1);
  document.documentElement.style.setProperty('--a2', a2);
  document.documentElement.style.setProperty('--b1', b1);
  document.documentElement.style.setProperty('--b2', b2);
}

/* Listen for live updates from tvt/<overlayId> */
onSnapshot(doc(db, 'tvt', OVERLAY_ID), (snap) => {
  const d = snap.data() || {};

  el.nameA.textContent = d.teamAName || 'Team A';
  el.nameB.textContent = d.teamBName || 'Team B';
  el.serA.textContent  = (d.seriesA ?? 0);
  el.serB.textContent  = (d.seriesB ?? 0);

  setLogo(el.logoA, d.logoA);
  setLogo(el.logoB, d.logoB);
  setThemeColors(d);

  // quick readability fade on change
  [el.nameA, el.nameB, el.serA, el.serB].forEach(n => { n.classList.remove('fade'); void n.offsetWidth; n.classList.add('fade'); });

  // refit names after every update
  fitText(el.nameA);
  fitText(el.nameB);
});

/* First fit for placeholders after fonts load */
window.addEventListener('load', () => { fitText(el.nameA); fitText(el.nameB); });
</script>
</body>
</html>
