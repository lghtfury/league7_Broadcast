<script type="module">
  // 1) Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

  // 2) Your Firebase project (league7overlay)
  const firebaseConfig = {
    apiKey: "AIzaSyD5mJAchcPP61x--oslD2y-tojorp3ysw8",
    authDomain: "league7overlay.firebaseapp.com",
    projectId: "league7overlay",
    storageBucket: "league7overlay.firebasestorage.app",
    messagingSenderId: "126648845416",
    appId: "1:126648845416:web:06be2078b0c95bbb97a7dd",
    measurementId: "G-QW2NG2BNF9"
  };

  // 3) Init
  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  // 4) Which doc to read (change if your repo uses a different path)
  const DOC_PATH = ["overlays", "main"];   // <-- edit if needed

  // 5) Helpers
  const $ = (id) => document.getElementById(id);

  function fitText(id) {
    const el = $(id);
    if (!el) return;
    const maxW = parseFloat(el.getAttribute("data-maxwidth") || "444");
    const max = 42, min = 18;
    el.style.fontSize = max + "px";
    let size = max;
    // shrink until it fits (stay centered via text-anchor/dominant-baseline)
    while (el.getBBox().width > maxW - 10 && size > min) {
      size -= 1;
      el.style.fontSize = size + "px";
    }
  }

  function render(d = {}) {
    // Try multiple possible field names so you don't have to change your panel
    const teamAName = d.teamAName ?? d.TeamA ?? "Team A";
    const teamBName = d.teamBName ?? d.TeamB ?? "Team B";
    const scoreA    = d.mapScoreA ?? d.teamAScore ?? d.scoreA ?? 0;
    const scoreB    = d.mapScoreB ?? d.teamBScore ?? d.scoreB ?? 0;

    // Update SVG text
    $("teamAName").textContent = teamAName;
    $("teamBName").textContent = teamBName;
    $("teamAScore").textContent = String(scoreA);
    $("teamBScore").textContent = String(scoreB);

    // Refit names to their plates
    fitText("teamAName");
    fitText("teamBName");
  }

  // 6) Subscribe for live updates
  const ref = doc(db, ...DOC_PATH);
  onSnapshot(ref, (snap) => {
    const d = snap.data() || {};
    render(d);
  }, (err) => {
    console.error("Firestore listener error:", err);
    // Fallback to placeholders if something goes wrong
    render();
  });

  // 7) Initial render so thereâ€™s no flash
  render();
</script>
