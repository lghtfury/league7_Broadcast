<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>League 7 In-Game Overlay</title>
  <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English+SC&display=swap" rel="stylesheet">
  <style>
    /* ---------- Base ---------- */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%; height: 100%;
      background: transparent !important;
      overflow: hidden;
      font-family: 'IM Fell English SC', serif;
    }

    :root{
      /* frame thickness and color fallbacks */
      --frame: 15px;
      --A1:#555; --A2:#333; /* Team A primary/secondary */
      --B1:#333; --B2:#111; /* Team B primary/secondary */
    }

    #overlay {
      position: relative;
      width: 1920px;
      height: 1080px;
      box-sizing: border-box;
      background: transparent !important;
    }

    /* Optional background art */
    #background {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      pointer-events: none;
      z-index: 0;
    }

    /* ---------- Gradient frame (no wash, border only) ---------- */
    #frame, #frame .edge { position: absolute; pointer-events: none; }
    #frame { inset: 0; z-index: 1; }

    .edge { background: transparent; }

    .edge.top    { left: 0; right: 0; top: 0; height: var(--frame); }
    .edge.bottom { left: 0; right: 0; bottom: 0; height: var(--frame); }
    .edge.left   { left: 0; top: 0; bottom: 0; width: var(--frame); }
    .edge.right  { right: 0; top: 0; bottom: 0; width: var(--frame); }

    /* Left/right use each team’s two tones (vertical fades) */
    .edge.left  { background: linear-gradient(to bottom, var(--A1), var(--A2)); }
    .edge.right { background: linear-gradient(to bottom, var(--B1), var(--B2)); }

    /* Top/bottom blend A→B; tweak if you want different behavior */
    .edge.top    { background: linear-gradient(to right, var(--A1), var(--B1)); }
    .edge.bottom { background: linear-gradient(to right, var(--A2), var(--B2)); }

    /* ---------- Team name + score ---------- */
    .team {
      position: absolute;
      top: 35px;
      color: white;
      font-weight: bold;
      font-size: 36px;
      z-index: 3;
      white-space: nowrap;
      max-width: 700px; /* room for swatches */
      overflow: hidden;
      text-overflow: ellipsis;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }
    #teamA { left: 390px; }
    #teamB { left: 1074px; }

    .team .name {
      display: inline-block;
      max-width: 540px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* The two little color boxes next to each team name */
    .swatches {
      display: inline-flex;
      gap: 6px;
    }
    .swatch {
      width: 18px;
      height: 18px;
      border-radius: 4px;
      border: 2px solid rgba(255,255,255,0.85);
      box-shadow: 0 0 4px rgba(0,0,0,0.6);
      background: transparent;
    }

    /* Scores */
    #scoreA, #scoreB {
      position: absolute;
      color: black;
      font-size: 56px;
      font-weight: bold;
      text-shadow: 2px 2px 4px #000;
      z-index: 3;
    }
    #scoreA { top: 87px; left: 595px; transform: translateX(-50%); }
    #scoreB { top: 86px; right: 595px; transform: translateX(50%); }
  </style>
</head>
<body>
  <div id="overlay">
    <!-- Optional background art -->
    <img id="background" src="overlay.png" alt="Overlay background" />

    <!-- Gradient border only -->
    <div id="frame" aria-hidden="true">
      <div class="edge top"></div>
      <div class="edge right"></div>
      <div class="edge bottom"></div>
      <div class="edge left"></div>
    </div>

    <!-- Team names with color boxes -->
    <div id="teamA" class="team">
      <span id="teamAName" class="name">Team A</span>
      <span class="swatches">
        <span id="A1sw" class="swatch" title="#555555"></span>
        <span id="A2sw" class="swatch" title="#333333"></span>
      </span>
    </div>

    <div id="teamB" class="team">
      <span id="teamBName" class="name">Team B</span>
      <span class="swatches">
        <span id="B1sw" class="swatch" title="#333333"></span>
        <span id="B2sw" class="swatch" title="#111111"></span>
      </span>
    </div>

    <!-- Scores -->
    <div id="scoreA">0</div>
    <div id="scoreB">0</div>
  </div>

  <script>
    /* ========= Cloud polling ON ========= */
    const USE_JSONBIN = true;
    const JSONBIN_LATEST = "https://api.jsonbin.io/v3/b/YOUR_BIN_ID/latest"; // <-- set your bin ID

    function safeColor(hex, fallback = "#222") {
      const v = String(hex || "").trim();
      return /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(v) ? v : fallback;
    }

    function adjustFontSize(id) {
      const el = document.getElementById(id);
      const length = (el.textContent || "").trim().length;
      el.style.fontSize =
        length > 20 ? "24px" :
        length > 16 ? "26px" :
        length > 12 ? "30px" : "36px";
    }

    // Update border gradients + the two color boxes beside each team
    function setBorderGradient(a1, a2, b1, b2) {
      const A1 = safeColor(a1, "#555");
      const A2 = safeColor(a2, "#333");
      const B1 = safeColor(b1, "#333");
      const B2 = safeColor(b2, "#111");

      const root = document.documentElement;
      root.style.setProperty("--A1", A1);
      root.style.setProperty("--A2", A2);
      root.style.setProperty("--B1", B1);
      root.style.setProperty("--B2", B2);

      // Update the little swatches + tooltips
      const A1sw = document.getElementById("A1sw");
      const A2sw = document.getElementById("A2sw");
      const B1sw = document.getElementById("B1sw");
      const B2sw = document.getElementById("B2sw");
      A1sw.style.background = A1; A1sw.title = A1.toUpperCase();
      A2sw.style.background = A2; A2sw.title = A2.toUpperCase();
      B1sw.style.background = B1; B1sw.title = B1.toUpperCase();
      B2sw.style.background = B2; B2sw.title = B2.toUpperCase();
    }

    function applyPayload(data) {
      if (!data) return;

      document.getElementById("teamAName").textContent = data.teamAName || data.teamA || "Team A";
      document.getElementById("teamBName").textContent = data.teamBName || data.teamB || "Team B";
      adjustFontSize("teamA"); // wrapper is fine for font sizing of text
      adjustFontSize("teamB");

      document.getElementById("scoreA").textContent = data.mapScoreA ?? 0;
      document.getElementById("scoreB").textContent = data.mapScoreB ?? 0;

      setBorderGradient(
        data?.teamAColors?.primary,
        data?.teamAColors?.secondary,
        data?.teamBColors?.primary,
        data?.teamBColors?.secondary
      );
    }

    // ----- LOCAL MODE (kept for dev) -----
    function initLocal() {
      try {
        const initial = JSON.parse(
          localStorage.getItem("matchData_ingame") ||
          localStorage.getItem("matchData") || "{}"
        );
        if (Object.keys(initial).length) applyPayload(initial);
      } catch (_) {}
      window.addEventListener("storage", (e) => {
        if (e.key === "matchData_ingame" || e.key === "matchData") {
          try { applyPayload(JSON.parse(e.newValue || "{}")); } catch (_) {}
        }
      });
    }

    // ----- JSONBIN MODE (cross‑app sync) -----
    let lastVersion = null;
    async function tickJSON() {
      try {
        const r = await fetch(JSONBIN_LATEST, { cache: "no-store" });
        if (!r.ok) throw new Error(r.status);
        const w = await r.json();
        const d = w?.record || w;
        if (!d) return;
        if (d.version !== lastVersion) {
          lastVersion = d.version;
          applyPayload(d);
        }
      } catch (e) {
        console.error("[overlay] JSONBin error:", e);
      }
    }
    function initJSON() {
      tickJSON();
      setInterval(tickJSON, 3000); // adjust interval if needed
    }

    // Boot
    USE_JSONBIN ? initJSON() : initLocal();
  </script>
</body>
</html>
