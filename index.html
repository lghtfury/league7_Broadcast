<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>League 7 Overlay</title>
  <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English+SC&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      overflow: hidden;
      font-family: 'IM Fell English SC', serif;
      width: 100%;
      height: 100%;
    }

    #overlay {
      position: relative;
      width: 1920px;
      height: 1080px;
      box-sizing: border-box;
      border: 15px solid;
      border-image: linear-gradient(135deg, #ff0000, #0000ff) 1;
      z-index: 1;
    }

    #background {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 0;
    }

    .team {
      position: absolute;
      font-weight: bold;
      font-size: 48px;
      color: white;
      text-shadow: 2px 2px 4px #000;
      z-index: 3;
    }

    .score {
      position: absolute;
      font-weight: bold;
      font-size: 56px;
      color: black;
      text-shadow: 2px 2px 4px #000;
      z-index: 3;
      width: 90px;
      text-align: center;
    }

    /* Team Names */
    #teamA { top: 35px; left: 390px; }
    #teamB { top: 35px; left: 1074px; }

    /* Score Boxes - Fine-tuned for center alignment */
    #scoreA { top: 92px; left: 555px; }
    #scoreB { top: 92px; left: 1276px; }

    #controlPanel {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 10px;
      color: white;
      font-size: 16px;
      z-index: 9999;
    }

    select, input {
      font-family: 'IM Fell English SC', serif;
      font-size: 16px;
      margin: 5px;
    }
  </style>
</head>
<body>
  <div id="overlay">
    <img id="background" src="overlay.png" alt="Overlay background" />

    <!-- Team Names -->
    <div id="teamA" class="team">Team A</div>
    <div id="teamB" class="team">Team B</div>

    <!-- Scores -->
    <div id="scoreA" class="score">0</div>
    <div id="scoreB" class="score">0</div>
  </div>

  <!-- Control Panel -->
  <div id="controlPanel">
    <label>Team A:
      <select id="selectTeamA"></select>
    </label>
    <label>Score A:
      <input type="number" id="scoreInputA" value="0" />
    </label>
    <br/>
    <label>Team B:
      <select id="selectTeamB"></select>
    </label>
    <label>Score B:
      <input type="number" id="scoreInputB" value="0" />
    </label>
    <br/>
    <button onclick="updateOverlay()">Update</button>
  </div>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSE9zzuZk-G-NTbxyXn9EkrMyUVoDexXP2Hu3vpuMsQPrLhxF_MxqSw-oNhC2BMs__dINFP3RR6f4sF/pub?gid=495267531&single=true&output=csv";
    const teamData = {};

    async function fetchTeamData() {
      const res = await fetch(sheetURL);
      const text = await res.text();
      const lines = text.split("\n").slice(1); // skip header

      lines.forEach(line => {
        const columns = line.split(",");
        const teamName = columns[0]?.trim();
        const primaryColor = columns[2]?.trim();
        const secondaryColor = columns[3]?.trim();

        if (teamName && primaryColor && secondaryColor) {
          teamData[teamName] = {
            primary: primaryColor,
            secondary: secondaryColor
          };
        }
      });

      populateDropdowns();
    }

    function populateDropdowns() {
      const teamASelect = document.getElementById("selectTeamA");
      const teamBSelect = document.getElementById("selectTeamB");
      teamASelect.innerHTML = "";
      teamBSelect.innerHTML = "";

      Object.keys(teamData).forEach(team => {
        const optionA = document.createElement("option");
        const optionB = document.createElement("option");
        optionA.value = optionB.value = team;
        optionA.textContent = optionB.textContent = team;
        teamASelect.appendChild(optionA);
        teamBSelect.appendChild(optionB);
      });
    }

    function updateOverlay() {
      const teamA = document.getElementById("selectTeamA").value;
      const teamB = document.getElementById("selectTeamB").value;
      const scoreA = document.getElementById("scoreInputA").value;
      const scoreB = document.getElementById("scoreInputB").value;

      const teamAStyles = teamData[teamA];
      const teamBStyles = teamData[teamB];

      const teamAEl = document.getElementById("teamA");
      const teamBEl = document.getElementById("teamB");

      document.getElementById("scoreA").textContent = scoreA;
      document.getElementById("scoreB").textContent = scoreB;

      teamAEl.textContent = teamA;
      teamBEl.textContent = teamB;

      // Always white text
      teamAEl.style.color = "#ffffff";
      teamBEl.style.color = "#ffffff";

      // Border gradient based on team colors
      if (teamAStyles && teamBStyles) {
        const borderStart = teamAStyles.primary || "#ff0000";
        const borderEnd = teamBStyles.primary || "#0000ff";
        document.getElementById("overlay").style.borderImage =
          `linear-gradient(135deg, ${borderStart}, ${borderEnd}) 1`;
      }
    }

    fetchTeamData();
  </script>
</body>
</html>
