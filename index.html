<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>League 7 In-Game Overlay</title>
  <!-- Base display font from your OG -->
  <link href="https://fonts.googleapis.com/css2?family=IM+Fell+English+SC&display=swap" rel="stylesheet">
  <!-- Add Inter for crisp scoreboard text (the font we used during calibration) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;800;900&display=swap" rel="stylesheet">
  <style>
    /* ---------- Base ---------- */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%; height: 100%;
      background: transparent !important;
      overflow: hidden;
      font-family: 'IM Fell English SC', serif;
    }

    :root{
      /* frame thickness and color fallbacks */
      --frame: 15px;
      --A1:#555; --A2:#333; /* Team A primary/secondary */
      --B1:#333; --B2:#111; /* Team B primary/secondary */
    }

    #overlay {
      position: relative;
      width: 1920px;
      height: 1080px;
      box-sizing: border-box;
      background: transparent !important;
    }

    /* Background art (kept transparent over game) */
    #background {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      pointer-events: none;
      z-index: 0;
    }

    /* ---------- Gradient frame (no wash, border only) ---------- */
    #frame, #frame .edge { position: absolute; pointer-events: none; }
    #frame { inset: 0; z-index: 1; }

    .edge { background: transparent; }
    .edge.top    { left: 0; right: 0; top: 0; height: var(--frame); }
    .edge.bottom { left: 0; right: 0; bottom: 0; height: var(--frame); }
    .edge.left   { left: 0; top: 0; bottom: 0; width: var(--frame); }
    .edge.right  { right: 0; top: 0; bottom: 0; width: var(--frame); }

    /* Left/right use each team’s two tones (vertical fade) */
    .edge.left  { background: linear-gradient(to bottom, var(--A1), var(--A2)); }
    .edge.right { background: linear-gradient(to bottom, var(--B1), var(--B2)); }
    /* Top/bottom blend A→B */
    .edge.top    { background: linear-gradient(to right, var(--A1), var(--B1)); }
    .edge.bottom { background: linear-gradient(to right, var(--A2), var(--B2)); }

    /* ---------- Calibrated UI (centers + fixed widths) ---------- */
    .name, .score {
      position: absolute;
      transform: translate(-50%, -50%); /* center on the given left/top */
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      pointer-events: none; /* good for OBS */
      font-family: Inter, system-ui, sans-serif; /* crisp scoreboard text */
    }

    /* Names (plates 444x52, font base 42px, white with drop shadow) */
    #teamAName {
      left: 611px; top: 58px; width: 444px; height: 52px;
      font-weight: 800; font-size: 42px; color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,.65);
    }
    #teamBName {
      left: 1301px; top: 58px; width: 444px; height: 52px;
      font-weight: 800; font-size: 42px; color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,.65);
    }

    /* Scores (tabs 192x51, font 56px, dark with subtle light shadow) */
    #teamAScore {
      left: 598px; top: 121px; width: 192px; height: 51px;
      font-weight: 900; font-size: 56px; color: #111;
      text-shadow: 0 1px 2px rgba(255,255,255,.6);
    }
    #teamBScore {
      left: 1320px; top: 121px; width: 192px; height: 51px;
      font-weight: 900; font-size: 56px; color: #111;
      text-shadow: 0 1px 2px rgba(255,255,255,.6);
    }
  </style>
</head>
<body>
  <div id="overlay">
    <!-- Optional background frame art (transparent over game) -->
    <img id="background" src="overlay.png" alt="Overlay background" />

    <!-- Gradient border only -->
    <div id="frame" aria-hidden="true">
      <div class="edge top"></div>
      <div class="edge right"></div>
      <div class="edge bottom"></div>
      <div class="edge left"></div>
    </div>

    <!-- Calibrated Team names and scores -->
    <div id="teamAName" class="name">Team A</div>
    <div id="teamBName" class="name">Team B</div>
    <div id="teamAScore" class="score">0</div>
    <div id="teamBScore" class="score">0</div>
  </div>

  <script>
    /* ---------- Utilities & helpers ---------- */
    function safeColor(hex, fallback = "#222") {
      const v = String(hex || "").trim();
      return /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(v) ? v : fallback;
    }

    function setBorderGradient(a1, a2, b1, b2) {
      const A1 = safeColor(a1, "#555");
      const A2 = safeColor(a2, "#333");
      const B1 = safeColor(b1, "#333");
      const B2 = safeColor(b2, "#111");
      const root = document.documentElement;
      root.style.setProperty("--A1", A1);
      root.style.setProperty("--A2", A2);
      root.style.setProperty("--B1", B1);
      root.style.setProperty("--B2", B2);
    }

    /* Tiny shrink-to-fit: keeps names inside 444px plates */
    function shrinkToFit(el, maxPx = 42, minPx = 18, pad = 10) {
      if (!el) return;
      el.style.fontSize = maxPx + "px";
      let size = maxPx;
      const limit = el.clientWidth - pad; // available width
      // Decrease font size until it fits or hits the min
      while (el.scrollWidth > limit && size > minPx) {
        size -= 1;
        el.style.fontSize = size + "px";
      }
    }

    function applyPayload(data) {
      if (!data) return;
      // Names
      const aName = data.teamAName || data.teamA || "Team A";
      const bName = data.teamBName || data.teamB || "Team B";
      const elA = document.getElementById("teamAName");
      const elB = document.getElementById("teamBName");
      elA.textContent = aName;
      elB.textContent = bName;
      shrinkToFit(elA);  // ensure fits 444px
      shrinkToFit(elB);

      // Scores
      document.getElementById("teamAScore").textContent = data.mapScoreA ?? data.teamAScore ?? data.scoreA ?? 0;
      document.getElementById("teamBScore").textContent = data.mapScoreB ?? data.teamBScore ?? data.scoreB ?? 0;

      // Border colors (optional)
      setBorderGradient(
        data?.teamAColors?.primary,
        data?.teamAColors?.secondary,
        data?.teamBColors?.primary,
        data?.teamBColors?.secondary
      );
    }
  </script>

  <!-- ---------- Firestore live reader (unchanged plumbing) ---------- -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD5mJAchcPP61x--oslD2y-tojorp3ysw8",
      authDomain: "league7overlay.firebaseapp.com",
      projectId: "league7overlay",
      storageBucket: "league7overlay.firebasestorage.app",
      messagingSenderId: "126648845416",
      appId: "1:126648845416:web:06be2078b0c95bbb97a7dd",
      measurementId: "G-QW2NG2BNF9"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // read ?overlay=... (default "main")
    const OVERLAY_ID = new URLSearchParams(location.search).get("overlay") || "main";

    // Live updates from Firestore
    onSnapshot(doc(db, "overlays", OVERLAY_ID), (snap) => {
      const data = snap.data();
      if (!data) return;
      window.applyPayload(data);
    });

    // Initial call for local preview (optional)
    window.applyPayload({});
  </script>
</body>
</html>
